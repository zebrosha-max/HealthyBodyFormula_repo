# SDD PHASE 3: TASK BREAKDOWN

### Эпик 1: Архитектура и База Данных (Backend)
*   [x] **TASK-1.1:** Создать проект в Supabase и настроить таблицу `users`.
*   [x] **TASK-1.2:** Создать таблицу `favorites` (SQL передан пользователю).
*   [x] **TASK-1.3:** Подключить `supabase-js` через CDN в `index.html`.
*   [x] **TASK-1.4:** Реализовать модуль `initUser`: проверка `initData` и синхронизация с БД.

### Эпик 2: UI Рефакторинг и Навигация
*   [x] **TASK-2.1:** Внедрить Bottom Navigation Bar.
*   [x] **TASK-2.2:** Создать секции-экраны: `<section id="screen-services">`, `<section id="screen-profile">`.
*   [x] **TASK-2.3:** Реализовать логику переключения табов.
*   [x] **UX-2.4:** Добавлены кнопки "Назад" в разделы Услуги и Профиль для SPA-целостности.
*   [x] **UX-2.5:** Реализован Deep Linking (`?screen=guides`) с автоматической очисткой URL.

### Эпик 3: Профиль и Услуги
*   [x] **TASK-3.1:** Верстка экрана "Услуги".
*   [x] **TASK-3.2:** Верстка экрана "Профиль".
*   [x] **TASK-3.3:** Связать UI профиля с данными из `initUser` (имя, статус).
*   [x] **TASK-3.4:** Динамическая подтяжка фото профиля из Telegram (fallback на градиент).
*   [x] **TASK-3.5:** Список избранных рецептов в профиле (синхронное обновление).

### Эпик 4: Рецепты (Фильтры и Избранное)
*   [x] **TASK-4.1:** Обновить структуру данных `recipesDB` (добавить kcal, time, category).
*   [x] **TASK-4.2:** Добавить визуальные "чипы" (badges) на карточки.
*   [x] **TASK-4.3:** Реализовать UI панель фильтров (горизонтальный скролл).
*   [x] **TASK-4.4:** Написать логику фильтрации.
*   [x] **TASK-4.5:** Реализовать кнопку "Избранное" (Supabase DB sync).
*   [x] **TASK-4.6:** Фильтр "Только избранное" в шапке раздела рецептов.
*   [x] **TASK-4.7:** Оптимизация базы: добавлен рецепт №21, обновлен скрипт `optimize_recipes.py` (умная проверка).

### Эпик 5: Платный Контент (Гайды)
*   [x] **TASK-5.1.A:** Написание и верстка 5 премиальных руководств (HTML).
*   [x] **TASK-5.1.B:** Написание и верстка 3 бесплатных чек-листов (HTML).
*   [x] **TASK-5.1.C:** Стандартизация UI карточек гайдов (цены, старые цены, премиум-звезды).
*   [ ] **TASK-5.1.D:** Перенос данных в `guidesDB` для динамического управления (в процессе).
*   [ ] **TASK-5.2:** Реализовать проверку прав (Premium Lock).
*   [ ] **TASK-5.3:** Реализовать UI заглушку для платного контента.

### Эпик 6: Smart Food Logger (AI + n8n + Integration)

#### 6.1 Database & Backend (Supabase + n8n)
*   [x] **TASK-6.1.1:** Спроектировать SQL схему таблицы `food_logs`. (Готово в `backend/supabase_schema.sql`)
*   [x] **TASK-6.1.2:** Применить миграцию БД в Supabase.
*   [x] **TASK-6.1.3:** Спроектировать n8n workflow для анализа. (Готово в `backend/hbf_workflow.json`)
*   [x] **TASK-6.1.4:** Доработать n8n workflow: добавить логику кнопок подтверждения (Inline Keyboard: "Save" / "Cancel").
*   [x] **TASK-6.1.5:** Доработать n8n workflow: финальная запись в Supabase только после нажатия "Save".

#### 6.2 Frontend: Точка входа и Навигация
*   [x] **TASK-6.2.1:** Добавить кнопку "Записать еду" (Floating Action Button или в шапке) на главном экране.
*   [x] **TASK-6.2.2:** Реализовать логику клика: закрытие WebApp или открытие чата с ботом (`Telegram.WebApp.openTelegramLink`).

#### 6.3 Frontend: Раздел "Дневник Питания" (Profile)
*   [x] **TASK-6.3.1:** В файле `app.js` создать модуль `FoodDiary`.
*   [x] **TASK-6.3.2:** Верстка таба "Дневник" внутри секции `#screen-profile`.
    *   Компонент: `DiaryHeader` (Прогресс бар калорий, цель по умолчанию 2000).
    *   Компонент: `DiaryList` (Список карточек за текущую дату).
*   [x] **TASK-6.3.3:** Интеграция с Supabase: выборка данных (`select * from food_logs where user_id = eq.UID and created_at = today`).
*   [x] **TASK-6.3.4:** Реализовать авто-обновление списка при входе в профиль.

#### 6.4 Telegram Bot UX
*   [x] **TASK-6.4.1:** Настроить BotFather: описание, аватарка.
*   [x] **TASK-6.4.2:** Настроить n8n на обработку Callback Query (нажатия кнопок Save/Cancel).

### Эпик 7: Water Tracker (Трекер воды)
*   [ ] **TASK-7.1:** Database: Создать таблицу `water_logs` и добавить колонки в `users` (`water_goal`, `water_reminder_active`).
*   [ ] **TASK-7.2:** Frontend (Logic): Создать модуль `WaterTracker` в `app.js` (addWater, getWater, renderWidget).
*   [ ] **TASK-7.3:** Frontend (UI): Верстка виджета воды в Профиле (Progress Wave/Bar, Buttons +250/-250).
*   [ ] **TASK-7.4:** Frontend (Settings): Добавить настройки воды в модальное окно настроек (Цель).
*   [ ] **TASK-7.5:** Backend (n8n): Создать Cron-workflow для напоминаний (раз в час проверять, пил ли пользователь).

### Эпик 8: Diary History & Analytics (История и Графики)
*   [ ] **TASK-8.1:** Frontend (Logic): Рефакторинг `renderFoodDiary` для поддержки аргумента `date` (вместо hardcode 'today').
*   [ ] **TASK-8.2:** Frontend (UI): Добавить навигацию по датам (< Вчера | Сегодня | Завтра >) в шапку Дневника.
*   [ ] **TASK-8.3:** Frontend (Stats): Реализовать модальное окно/виджет с графиком калорий за последние 7 дней (CSS Chart).
*   [ ] **TASK-8.4:** Backend (Supabase): Оптимизация запросов (индексы на `created_at`).
