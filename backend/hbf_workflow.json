{
  "name": "HBF Smart Logger (Gemini 3.0)",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "telegram-trigger",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [
        460,
        300
      ],
      "webhookId": "hbf-telegram-webhook"
    },
    {
      "parameters": {
        "dataType": "string",
        "value1": "={{ $json.message.voice ? 'voice' : ($json.message.photo ? 'photo' : 'text') }}",
        "rules": {
          "rules": [
            {
              "value2": "text",
              "output": 0
            },
            {
              "value2": "photo",
              "output": 1
            },
            {
              "value2": "voice",
              "output": 2
            }
          ]
        }
      },
      "id": "switch-type",
      "name": "Check Type",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        680,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-3.0-flash:generateContent",
        "sendQuery": true,
        "queryParameters": {
          "key": "={{ $env.GOOGLE_API_KEY }}"
        },
        "sendBody": true,
        "contentType": "json",
        "body": "={\n  \"contents\": [{\n    \"parts\": [{\n      \"text\": \"–¢—ã –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –∏ –≤–µ—Ä–Ω–∏ JSON —Å –ë–ñ–£–ö. –§–æ—Ä–º–∞—Ç: {\\\"dish\\\": \\\"–ù–∞–∑–≤–∞–Ω–∏–µ\\\", \\\"calories\\\": 0, \\\"protein\\\": 0, \\\"fat\\\": 0, \\\"carbs\\\": 0}. –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –µ–¥–∞, –≤–µ—Ä–Ω–∏ {\\\"error\\\": \\\"–ù–µ –µ–¥–∞\\\". –¢–µ–∫—Å—Ç: {{ $json.message.text }}\"\n    }]\n  }]\n}",
        "options": {}
      },
      "id": "gemini-text",
      "name": "Gemini (Text)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        960,
        100
      ]
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": "={{ $json.message.photo[$json.message.photo.length - 1].file_id }}"
      },
      "id": "get-photo",
      "name": "Get Photo",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        960,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-3.0-flash:generateContent",
        "sendQuery": true,
        "queryParameters": {
          "key": "={{ $env.GOOGLE_API_KEY }}"
        },
        "sendBody": true,
        "contentType": "json",
        "body": "={\n  \"contents\": [{\n    \"parts\": [
      {
        \"text\": \"–¢—ã –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥. –û—Ü–µ–Ω–∏ –ë–ñ–£–ö –ø–æ —Ñ–æ—Ç–æ. –í–µ—Ä–Ω–∏ JSON: {\\\"dish\\\": \\\"–ù–∞–∑–≤–∞–Ω–∏–µ\\\", \\\"calories\\\": 0, \\\"protein\\\": 0, \\\"fat\\\": 0, \\\"carbs\\\": 0}.\"
      },
      {
        \"inline_data\": {
          \"mime_type\": \"image/jpeg\",
          \"data\": \"{{ $binary.data.data }}"
        }
      }
    ]
  }]
}",
        "options": {}
      },
      "id": "gemini-photo",
      "name": "Gemini (Photo)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1180,
        300
      ]
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": "={{ $json.message.voice.file_id }}"
      },
      "id": "get-voice",
      "name": "Get Voice",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        960,
        500
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-3.0-flash:generateContent",
        "sendQuery": true,
        "queryParameters": {
          "key": "={{ $env.GOOGLE_API_KEY }}"
        },
        "sendBody": true,
        "contentType": "json",
        "body": "={\n  \"contents\": [{\n    \"parts\": [
      {
        \"text\": \"–¢—ã –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥. –ü–æ—Å–ª—É—à–∞–π –∞—É–¥–∏–æ –∏ –≤—ã–¥–µ–ª–∏ —Å—ä–µ–¥–µ–Ω–Ω–æ–µ. –í–µ—Ä–Ω–∏ JSON: {\\\"dish\\\": \\\"–ù–∞–∑–≤–∞–Ω–∏–µ\\\", \\\"calories\\\": 0, \\\"protein\\\": 0, \\\"fat\\\": 0, \\\"carbs\\\": 0}.\"
      },
      {
        \"inline_data\": {
          \"mime_type\": \"{{ $binary.data.mime }}",
          \"data\": \"{{ $binary.data.data }}"
        }
      }
    ]
  }]
}",
        "options": {}
      },
      "id": "gemini-voice",
      "name": "Gemini (Voice)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1180,
        500
      ]
    },
    {
      "parameters": {
        "table": "food_logs",
        "columns": "user_id, dish_name, calories, protein, fat, carbs, log_text",
        "options": {}
      },
      "id": "supabase-insert",
      "name": "Supabase Insert",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1500,
        300
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger\"].json.message.chat.id }}",
        "text": "=‚úÖ –ó–∞–ø–∏—Å–∞–Ω–æ: {{ $json.dish_name }}\nüî• {{ $json.calories }} –∫–∫–∞–ª\nü•© –ë: {{ $json.protein }} | ü•ë –ñ: {{ $json.fat }} | üçû –£: {{ $json.carbs }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "telegram-reply",
      "name": "Telegram Reply",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1720,
        300
      ]
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Check Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Type": {
      "main": [
        [
          {
            "node": "Gemini (Text)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Photo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Voice",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Photo": {
      "main": [
        [
          {
            "node": "Gemini (Photo)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Voice": {
      "main": [
        [
          {
            "node": "Gemini (Voice)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini (Text)": {
      "main": [
        [
          {
            "node": "Supabase Insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini (Photo)": {
      "main": [
        [
          {
            "node": "Supabase Insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini (Voice)": {
      "main": [
        [
          {
            "node": "Supabase Insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Insert": {
      "main": [
        [
          {
            "node": "Telegram Reply",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}